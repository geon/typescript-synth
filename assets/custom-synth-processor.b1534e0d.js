var u=Object.defineProperty;var f=(s,e,t)=>e in s?u(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(f(s,typeof e!="symbol"?e+"":e,t),t);import{c as p}from"./processor-keys.00085133.js";function m(s,e,t){return s+(e-s)*t}function c(s,e,t,i,r){const o=1-t/i;return m(s,e,Math.pow(o,1/r))}class g{constructor(e){a(this,"state");this.envelope=e,this.state={value:0,stage:"attack",timeLeftOfStage:e.attack,releaseStartValue:0}}setNoteOff(){this.state.stage="release",this.state.timeLeftOfStage=this.envelope.release,this.state.releaseStartValue=this.state.value}getNextSample(e){switch(this.state.stage){case"attack":{const t=c(0,1,this.state.timeLeftOfStage,this.envelope.attack,2);return this.state.value=t,this.state.timeLeftOfStage-=1/e,this.state.timeLeftOfStage<0&&(this.state.stage="decay",this.state.timeLeftOfStage+=this.envelope.decay),t}case"decay":{const t=c(1,this.envelope.sustainLevel,this.state.timeLeftOfStage,this.envelope.decay,2);return this.state.value=t,this.state.timeLeftOfStage-=1/e,this.state.timeLeftOfStage<0&&(this.state.stage="sustain"),t}case"sustain":return this.envelope.sustainLevel;case"release":{const t=c(this.state.releaseStartValue,0,this.state.timeLeftOfStage,this.envelope.release,2);return this.state.value=t,this.state.timeLeftOfStage-=1/e,this.state.timeLeftOfStage<0&&(this.state.stage="done"),t}case"done":return 0}}}function S(s){return 440*Math.pow(2,(s-69)/12)}class h{constructor(e,t){this.periodRatio=e,this.frequency=t}setFrequency(e){this.frequency=e}getNextSample(e){const t=this.frequency/e;return this.periodRatio+=t,this.periodRatio>=1&&(this.periodRatio-=1),this.periodRatio}}class d{constructor(e,t){a(this,"oscilator");this.oscilator=new h(e,t)}setFrequency(e){this.oscilator.setFrequency(e)}getNextSample(e){return Math.sin(this.oscilator.getNextSample(e)*Math.PI*2)}}class y{constructor(e,t){a(this,"oscilator");a(this,"lfo");a(this,"baseFrequency");this.oscilator=new h(e,t),this.lfo=new d(0,5),this.baseFrequency=t}setFrequency(e){this.baseFrequency=e}getNextSample(e){return this.oscilator.setFrequency(this.baseFrequency+this.lfo.getNextSample(e)*this.baseFrequency/100),this.oscilator.getNextSample(e)}}class O extends AudioWorkletProcessor{constructor({processorOptions:t}){super();a(this,"sampleRate");a(this,"toneOscilator");a(this,"envelope");this.sampleRate=t.sampleRate,this.port.onmessage=i=>{var r;i.data.type==="noteon"&&(this.toneOscilator=new y(0,S(i.data.number)),this.envelope=new g({attack:1,decay:2,sustainLevel:.75,release:1})),i.data.type==="noteoff"&&((r=this.envelope)==null||r.setNoteOff())}}process(t,i,r){var l;if(this.toneOscilator===void 0||this.envelope==null)return!0;const o=(l=i[0])==null?void 0:l[0];if(!o)throw new Error("Missing channel.");for(let n=0;n<o.length;n++)o[n]=this.toneOscilator.getNextSample(this.sampleRate)*this.envelope.getNextSample(this.sampleRate)*.3;return!0}}registerProcessor(p,O);
